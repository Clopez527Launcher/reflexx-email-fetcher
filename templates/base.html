<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Manager Dashboard{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- ‚úÖ Make MANAGER_ID available before dashboard.js runs -->
  <script>
    window.MANAGER_ID = {{ (session.get('manager_id') or 4) | int }};
  </script>
  <!-- ‚úÖ Your bundle (file lives at /static/dashboard.js) -->
  <script defer src="{{ url_for('static', filename='dashboard.js') }}"></script>

  {% block head %}{% endblock %}

  <!-- ‚úÖ Layout: locked top banner + fixed sidebar + content aligned correctly -->
		<style>
				:root{
						--banner-h: 70px;       /* top banner height */
						--sidebar-w: 230px;     /* sidebar width */
						--sidebar-x: 20px;      /* sidebar distance from left edge */
						--gap: 18px;            /* space between sidebar and content */
						--pad-x: 22px;          /* content left/right padding */
						--pad-top: 5px;        /* ‚úÖ bring content UP/DOWN under banner (smaller = higher) */
						--sidebar-bottom-gap: 14px; /* ‚úÖ makes sidebar NOT feel too tall */
				}

				html, body { margin: 0; padding: 0; }

				/* ‚úÖ Push the whole page down exactly 1 banner height (prevents double spacing) */
				body{
						padding-top: var(--banner-h);
				}

				/* ‚úÖ LOCK banner at top (stays while scrolling) */
				.top-banner{
						height: var(--banner-h);
						position: fixed;
						top: 0;
						left: 0;
						right: 0;
						z-index: 1000;

						/* optional but recommended so it always looks like a true header */
						background: #0b1623;
						border-bottom: 1px solid rgba(255,255,255,0.06);
				}

				/* ‚úÖ Sidebar fixed under banner */
				.floating-nav{
						position: fixed !important;
						top: calc(var(--banner-h) + 12px) !important; /* ‚úÖ small gap under banner */
						left: var(--sidebar-x) !important;
						width: var(--sidebar-w) !important;

						/* ‚úÖ Not ‚Äútoo tall‚Äù */
						height: calc(100vh - var(--banner-h) - 12px - var(--sidebar-bottom-gap)) !important;

						overflow-y: auto;
						padding-bottom: 14px; /* keeps logout from hugging bottom */
						z-index: 900;
				}

				/* ‚úÖ Content starts right of sidebar (NO margin-top anymore) */
				.main-content{
						margin-left: calc(var(--sidebar-x) + var(--sidebar-w) + var(--gap));
						padding: var(--pad-top) var(--pad-x) 40px var(--pad-x);
						padding-right: calc(var(--pad-x) + 12px);
						box-sizing: border-box;
						min-height: calc(100vh - var(--banner-h));
				}

				/* ‚úÖ Mobile fallback */
				@media (max-width: 900px){
						body{ padding-top: var(--banner-h); }

						.floating-nav{
								position: static !important;
								width: auto !important;
								height: auto !important;
								left: 0 !important;
								top: 0 !important;
								margin: 12px 12px 0 12px;
						}

						.main-content{
								margin-left: 0;
								padding-top: 12px;
						}
				}
		</style>

		</head>

		<body data-manager-id="{{ (session.get('manager_id') or 4) | int }}">

				<!-- üåà Gradient Definition (shared across all pages) -->
				<svg style="display: none;">
						<defs>
								<linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
										<stop offset="0%" stop-color="#00aaff" />
										<stop offset="50%" stop-color="#00cccc" />
										<stop offset="100%" stop-color="#00ff99" />
								</linearGradient>
						</defs>
				</svg>

				<!-- üîù Top Banner (DO NOT set position inline) -->
				<div class="top-banner" style="display:flex; align-items:center; justify-content:center; position:fixed;">
						<!-- Centered logo -->
						<img src="{{ url_for('static', filename='Reflexx_Icon.ico') }}" alt="Reflexx Logo" style="display:block;">

						<!-- ‚öôÔ∏è Settings gear (top right) -->
						<a href="{{ url_for('settings') }}" title="Settings"
									style="position:absolute; right:16px; top:50%; transform:translateY(-50%);
																color:#ffffff; text-decoration:none; font-size:20px; line-height:20px;">
								‚öôÔ∏è
						</a>
				</div>

				<!-- üîó Sidebar + Main -->
				<div>
						<!-- Sidebar Navigation -->
						<div class="floating-nav">
								<h2 class="app-title" style="margin-top:18px;">Reflexx</h2>

								<a href="{{ url_for('dashboard_new') }}"
											class="nav-btn {% if request.endpoint == 'dashboard_new' %}active{% endif %}">
										Dashboard
								</a>

								<a href="{{ url_for('uploads') }}"
											class="nav-btn {% if request.endpoint == 'uploads' %}active{% endif %}">
										Uploads
								</a>

								<a href="{{ url_for('manager_portal') }}"
											class="nav-btn {% if request.endpoint == 'manager_portal' %}active{% endif %}">
										Analytics
								</a>

								<a href="{{ url_for('analytics') }}"
											class="nav-btn {% if request.endpoint == 'analytics' %}active{% endif %}">
										Graphs
								</a>

								<a href="{{ url_for('ai_insights_tab') }}"
											class="nav-btn {% if request.endpoint == 'ai_insights_tab' %}active{% endif %}">
										AI Insights
								</a>

								<a href="{{ url_for('reports') }}"
											class="nav-btn {% if request.endpoint == 'reports' %}active{% endif %}">
										Reports
								</a>

								<button class="logout-btn" id="logoutBtn">Logout</button>
								<a href="{{ url_for('brick') }}" class="easter-egg">üéÆ</a>
						</div>

						<!-- Page Content -->
						<div class="main-content">
								{% block content %}{% endblock %}
						</div>
				</div>

				{% block scripts %}{% endblock %}
		</body>


  <!-- üîó Auto-refresh RingCentral (single copy, safe globally) + logout cache clear -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const startEl = document.getElementById('cm-start');
    const endEl   = document.getElementById('cm-end');
    const applyBtn = document.getElementById('cm-apply');

    function triggerRC() {
      if (window.__CALLSTATS_SINGLETON !== 'inline') {
        if (typeof window.applyDateRangeFetch === 'function') {
          window.applyDateRangeFetch();
        } else if (applyBtn) {
          applyBtn.click();
        }
      }
    }

    [startEl, endEl].forEach(el => {
      if (!el) return;
      el.addEventListener('change', triggerRC);
      el.addEventListener('keydown', e => { if (e.key === 'Enter') triggerRC(); });
    });

    // ‚úÖ Clear manager/employee cache on logout
    document.getElementById('logoutBtn')?.addEventListener('click', () => {
      localStorage.removeItem('MANAGER_ID');
      localStorage.removeItem('employee_id');
      window.location.href = "{{ url_for('logout') }}";
    });
  });
  </script>
</body>
</html>
