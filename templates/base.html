<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Manager Dashboard{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- ‚úÖ Make MANAGER_ID available before dashboard.js runs -->
  <script>
    window.MANAGER_ID = {{ (session.get('manager_id') or 4) | int }};
  </script>

  <!-- ‚úÖ Load dashboard.js on Dashboard + Analytics + Graphs (so charts can render everywhere) -->
  {% if request.endpoint in ['dashboard_new', 'manager_portal', 'analytics'] %}
    <script defer src="{{ url_for('static', filename='dashboard.js') }}"></script>
  {% endif %}

  {% block head %}{% endblock %}

  <style>
    :root{
      --banner-h: 70px;
      --sidebar-w: 230px;
      --sidebar-x: 20px;
      --gap: 18px;
      --pad-x: 22px;
      --pad-top: 0px;
      --sidebar-bottom-gap: 50px;

      /* üåà Background palette (LIGHTER like the mock) */
      --bg-0: #0b2a33;  /* teal-ish */
      --bg-1: #0f3b44;  /* mid teal */
      --bg-2: #0e3f4a;  /* deeper teal */
      --bg-3: #0a2b3f;  /* soft navy-teal */

      /* ‚úÖ DARK SOLID widgets (no glass) */
      /* a little darker than the chart square */
      --card-bg: #0e151d;                 /* dark charcoal */
      --card-br: rgba(255,255,255,0.10); /* soft edge */
      --card-tx: #f1f6ff;                 /* white-ish text */
      --card-sub: rgba(241,246,255,0.70);
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: transparent !important;
    }

    body{
      padding-top: var(--banner-h);
      min-height: 100vh;
      color: #e9f6ff;
      overflow-x: hidden;
      position: relative;
    }

    /* =========================================
       ‚úÖ TRUE GLOBAL GRADIENT LAYER
       ========================================= */
    .bg-layer{
      position: fixed;
      inset: 0;
      z-index: -999;
      pointer-events: none;

      background:
        radial-gradient(1200px 680px at 72% 18%,
          rgba(0, 230, 230, 0.30),
          rgba(0, 230, 230, 0.12) 35%,
          transparent 68%),

        radial-gradient(980px 600px at 26% 62%,
          rgba(0, 255, 153, 0.24),
          rgba(0, 255, 153, 0.10) 40%,
          transparent 72%),

        radial-gradient(760px 520px at 84% 86%,
          rgba(255, 255, 255, 0.10),
          rgba(255, 255, 255, 0.04) 45%,
          transparent 75%),

        linear-gradient(180deg,
          var(--bg-0) 0%,
          var(--bg-1) 38%,
          var(--bg-2) 72%,
          var(--bg-3) 100%);

      filter: saturate(1.08) brightness(1.18);
      transform: translateZ(0);
    }

    /* =========================================
       ‚úÖ FORCE ALL PAGE WRAPPERS TRANSPARENT
       ========================================= */
    .main-content,
    .content,
    .content-wrapper,
    .page-wrapper,
    .container,
    .container-fluid,
    .reports-layout,
    .dashboard-layout,
    .graphs-layout,
    .analytics-layout{
      background: transparent !important;
    }

    /* ‚úÖ LOCK banner at top */
    .top-banner{
						height: var(--banner-h);
						position: fixed;
						top: 0; left: 0; right: 0;
						z-index: 1000;

						/* ‚úÖ SOLID BLACK ribbon */
						background: #000 !important;

						/* ‚úÖ remove any ‚Äúglass‚Äù / gradient bleed */
						backdrop-filter: none !important;
						-webkit-backdrop-filter: none !important;

						border-bottom: 1px solid rgba(255,255,255,0.10);
				}
				
				/* ‚úÖ Always-dead-center logo (never shifts) */
				.top-banner img{
						position: absolute;
						left: 50%;
						top: 50%;
						transform: translate(-50%, -50%);
						display: block;
						height: 28px;
						width: auto;
				}

				/* ‚úÖ Settings icon pinned right */
				.top-banner .top-settings{
						position: absolute;
						right: 16px;
						top: 50%;
						transform: translateY(-50%);
						color: #fff;
						text-decoration: none;
						font-size: 20px;
						line-height: 20px;
				}

    /* ‚úÖ Sidebar fixed under banner */
    .floating-nav{
      position: fixed !important;
      top: calc(var(--banner-h) + 22px) !important;
      left: var(--sidebar-x) !important;
      width: var(--sidebar-w) !important;

      height: calc(100vh - var(--banner-h) - 12px - var(--sidebar-bottom-gap)) !important;
      overflow-y: auto;
      padding-bottom: 14px;
      z-index: 900;
    }

    /* ‚úÖ Content starts right of sidebar */
    .main-content{
      margin-left: calc(var(--sidebar-x) + var(--sidebar-w) + var(--gap));
      padding: var(--pad-top) var(--pad-x) 40px var(--pad-x);
      padding-right: calc(var(--pad-x) + 12px);
      box-sizing: border-box;
      min-height: calc(100vh - var(--banner-h));
    }
				
				/* ‚úÖ Sidebar outline = gray (no neon) */
				.floating-nav{
						border: 1px solid rgba(255,255,255,0.18) !important; /* gray outline */
						box-shadow: none !important;                          /* kill neon glow */
				}

				/* ‚úÖ If anything inside adds neon glow, kill it too */
				.floating-nav *{
						box-shadow: none !important;
				}


    /* =========================================
       ‚úÖ DARK SOLID WIDGETS (NO GLASS)
       ========================================= */
    .kpi-card,
    .widget,
    .widget-card,
    .panel,
    .card{
      position: relative;
      background: var(--card-bg) !important;
      border: 1px solid var(--card-br) !important;
      border-radius: 16px;

      /* ‚ùå kill all glass */
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;

      /* ‚úÖ solid card shadow */
      box-shadow: 0 12px 28px rgba(0,0,0,0.35);
    }

    /* ‚ùå remove any overlay layers if any widget CSS adds them */
    .kpi-card::before,
    .widget::before,
    .widget-card::before,
    .panel::before,
    .card::before,
    .kpi-card::after,
    .widget::after,
    .widget-card::after,
    .panel::after,
    .card::after{
      content: none !important;
      display: none !important;
    }

    /* ‚úÖ Force readable WHITE text inside widgets */
    .kpi-card,
    .widget,
    .widget-card,
    .panel,
    .card{
      color: var(--card-tx) !important;
    }
    .kpi-card * ,
    .widget * ,
    .widget-card * ,
    .panel * ,
    .card *{
      color: inherit;
    }

    .kpi-card .muted,
    .widget .muted,
    .widget-card .muted,
    .panel .muted,
    .card .muted{
      color: var(--card-sub) !important;
    }

    /* ‚úÖ Inputs / dropdowns look better on dark cards */
    input, select, textarea{
      color: #e9f6ff;
    }

    /* ‚úÖ Mobile fallback */
    @media (max-width: 900px){
      .floating-nav{
        position: static !important;
        width: auto !important;
        height: auto !important;
        left: 0 !important;
        top: 0 !important;
        margin: 12px 12px 0 12px;
      }
      .main-content{
        margin-left: 0;
        padding-top: 12px;
      }
    }
  </style>
</head>

<body data-manager-id="{{ (session.get('manager_id') or 4) | int }}">

  <!-- ‚úÖ Global background gradient -->
  <div class="bg-layer"></div>

  <!-- üåà Gradient Definition (shared across all pages) -->
  <svg style="display: none;">
    <defs>
      <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#00aaff" />
        <stop offset="50%" stop-color="#00cccc" />
        <stop offset="100%" stop-color="#00ff99" />
      </linearGradient>
    </defs>
  </svg>

  <!-- üîù Top Banner -->
  <div class="top-banner">
    <img src="{{ url_for('static', filename='Reflexx_Icon.ico') }}" alt="Reflexx Logo" style="display:block;">

    <a href="{{ url_for('settings') }}" title="Settings" class="top-settings">
      ‚öôÔ∏è
    </a>
  </div>

  <!-- üîó Sidebar + Main -->
  <div>
    <div class="floating-nav">
      <h2 class="app-title" style="margin-top:18px;">Reflexx</h2>

      <a href="{{ url_for('dashboard_new') }}"
         class="nav-btn {% if request.endpoint == 'dashboard_new' %}active{% endif %}">
        Dashboard
      </a>

      <a href="{{ url_for('uploads') }}"
         class="nav-btn {% if request.endpoint == 'uploads' %}active{% endif %}">
        Uploads
      </a>

      <a href="{{ url_for('manager_portal') }}"
         class="nav-btn {% if request.endpoint == 'manager_portal' %}active{% endif %}">
        Analytics
      </a>

      <a href="{{ url_for('analytics') }}"
         class="nav-btn {% if request.endpoint == 'analytics' %}active{% endif %}">
        Graphs
      </a>

      <a href="{{ url_for('ai_insights_tab') }}"
         class="nav-btn {% if request.endpoint == 'ai_insights_tab' %}active{% endif %}">
        AI Insights
      </a>

      <a href="{{ url_for('reports') }}"
         class="nav-btn {% if request.endpoint == 'reports' %}active{% endif %}">
        Reports
      </a>

      <button class="logout-btn" id="logoutBtn">Logout</button>
      <a href="{{ url_for('brick') }}" class="easter-egg">üéÆ</a>
    </div>

    <div class="main-content">
      {% block content %}{% endblock %}
    </div>
  </div>

  {% block scripts %}{% endblock %}

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const startEl = document.getElementById('cm-start');
    const endEl   = document.getElementById('cm-end');
    const applyBtn = document.getElementById('cm-apply');

    function triggerRC() {
      if (window.__CALLSTATS_SINGLETON !== 'inline') {
        if (typeof window.applyDateRangeFetch === 'function') {
          window.applyDateRangeFetch();
        } else if (applyBtn) {
          applyBtn.click();
        }
      }
    }

    [startEl, endEl].forEach(el => {
      if (!el) return;
      el.addEventListener('change', triggerRC);
      el.addEventListener('keydown', e => { if (e.key === 'Enter') triggerRC(); });
    });

    document.getElementById('logoutBtn')?.addEventListener('click', () => {
      localStorage.removeItem('MANAGER_ID');
      localStorage.removeItem('employee_id');
      window.location.href = "{{ url_for('logout') }}";
    });
  });
  </script>

</body>
</html>

